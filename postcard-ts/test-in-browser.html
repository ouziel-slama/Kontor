<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>postcard-ts browser proof</title>
    <script type="module">
      import { serializeInst, deserializeInst } from "./ts/postcard-ts.js";

      async function run() {
        console.log("Testing in the actual browser right now…");

        console.log("Running publish test");
        var inst = {
          Publish: {
            gas_limit: 1000000,
            name: "foo",
            bytes: Array.from(new Uint8Array([1, 2, 3, 4])),
          },
        };
        var str = JSON.stringify(inst);
        var bs = serializeInst(str);
        var result = deserializeInst(bs);
        if (result !== str) {
          throw new Error("Deserialized string should match original");
        }
        console.log("Passed");

        console.log("Running call test");
        var inst = {
          Call: {
            gas_limit: 1000000,
            contract: "foo_1_2",
            expr: "foo()",
          },
        };
        var str = JSON.stringify(inst);
        var bs = serializeInst(str);
        var result = deserializeInst(bs);
        if (result !== str) {
          throw new Error("Deserialized string should match original");
        }
        console.log("Passed");

        console.log("Running issuance test");
        var inst = "Issuance";
        var str = JSON.stringify(inst);
        var bs = serializeInst(str);
        var result = deserializeInst(bs);
        if (result !== str) {
          throw new Error("Deserialized string should match original");
        }
        console.log("Passed");

        document.body.innerHTML =
          "<h1 style='color:green'>All 3 tests passed in the browser! </h1>";
      }

      run().catch((e) => {
        console.error("FAILED in browser:", e);
        document.body.innerHTML = `<h1 style='color:red'>Failed: ${e.message}</h1>`;
      });
    </script>
  </head>
  <body style="font-family: system-ui">
    <h1>Running postcard-ts in the browser…</h1>
    <pre id="log"></pre>
  </body>
</html>
